# 🧪 智能升级提示系统测试指南

**测试目的**: 验证所有 5 个升级提示触发点正常工作

---

## 🚀 快速开始

```bash
pnpm dev
```

访问 http://localhost:3000

---

## 📋 测试清单

### 测试 1: 未登录用户流程 ⭐

**目标**: 验证登录引导逻辑

#### 步骤

1. **确保未登录状态**
   - 如果已登录，点击右上角头像 → Sign out
   
2. **解析 5 次梦境**
   
   使用这些测试梦境（复制粘贴即可）:
   ```
   第1次: I was flying over mountains
   第2次: I was swimming in a clear ocean
   第3次: I was walking through a forest
   第4次: I was climbing a tall building
   第5次: I was dancing under the stars
   ```

3. **观察提示**
   
   | 次数 | 预期效果 | ✓ |
   |------|---------|---|
   | 1-2次 | 无提示，右上角显示剩余次数 | □ |
   | 3-4次 | 顶部显示黄色 Alert："You have X left today" | □ |
   | 5次用完 | 🔐 **登录对话框弹出** | □ |

4. **验证对话框内容**
   - [ ] 标题："Unlock More Dream Interpretations"
   - [ ] 描述："You've used all 5 free interpretations today"
   - [ ] Google 登录按钮显示
   - [ ] GitHub 登录按钮显示
   - [ ] "Maybe Later" 按钮可关闭

5. **测试登录**
   - [ ] 点击 Google/GitHub 登录
   - [ ] 登录后对话框自动关闭
   - [ ] 剩余次数变为 10（已登录）

---

### 测试 2: 已登录用户流程 ⭐⭐

**目标**: 验证升级引导逻辑

#### 步骤

1. **确保已登录**
   - 点击右上角"Continue with Google/GitHub"登录

2. **解析 5 次梦境**
   
   继续使用测试梦境，观察每次解析后的变化

3. **验证提示（重点！）**
   
   | 次数 | 剩余 | 预期效果 | ✓ |
   |------|------|---------|---|
   | 1-2次 | 9-8 | 无特殊提示 | □ |
   | **3次** | **7** | 🎉 **Toast: "Great insight, right?"** | □ |
   | | | 💎 **升级卡片出现**（结果下方） | □ |
   | **4次** | **6** | 💫 **Toast: "Last one for today!"** | □ |
   | | | 💎 升级卡片继续显示 | □ |
   | **5次** | **5** | 👑 **升级对话框弹出** | □ |

4. **验证第 3 次 Toast**
   - [ ] 标题："Great insight, right? 🌟"
   - [ ] 描述："Only 2 interpretations left today. Upgrade for 50/month!"
   - [ ] "View Plans" 按钮显示
   - [ ] 点击按钮跳转到 /pricing
   - [ ] 8 秒后自动消失

5. **验证第 4 次 Toast**
   - [ ] 标题："Last one for today! 💫"
   - [ ] 描述："Upgrade to Basic for unlimited daily access."
   - [ ] "Upgrade Now" 按钮显示
   - [ ] 点击按钮跳转到 /pricing
   - [ ] 10 秒后自动消失

6. **验证升级卡片**（结果下方）
   - [ ] 在第 3-4 次解析后显示
   - [ ] 卡片有发光效果（glow-box）
   - [ ] 显示 Crown 图标
   - [ ] 标题："Loving the insights? ✨"
   - [ ] 显示剩余次数（动态）
   - [ ] "View Plans" 按钮跳转到 /pricing

7. **验证升级对话框**（第 5 次用完）
   - [ ] 自动弹出（不需要点击）
   - [ ] 标题："Ready for More? 👑"
   - [ ] 描述包含"50 interpretations/month"
   - [ ] 显示 4 个特性列表
   - [ ] "Upgrade to Basic - $4.99/mo" 按钮
   - [ ] 点击按钮跳转到 /pricing
   - [ ] "Maybe Tomorrow" 可关闭
   - [ ] 显示"14-day money-back guarantee"

---

### 测试 3: 边界情况 ⭐

#### 3.1 登录状态切换

```bash
步骤:
1. 未登录解析 3 次
2. 点击登录
3. 登录后继续解析

验证:
- [ ] 使用次数独立计算
- [ ] 从 3/5 变为 0/10（新的计数）
- [ ] 不显示任何对话框（还没达到限制）
```

#### 3.2 跨天重置

```bash
步骤:
1. 用完今天的次数（5 或 10 次）
2. 修改系统时间到明天
3. 刷新页面

验证:
- [ ] 使用次数重置为 0
- [ ] 剩余次数恢复
- [ ] 可以继续使用
```

#### 3.3 快速连续解析

```bash
步骤:
1. 快速解析 5 次（不等 Toast 消失）

验证:
- [ ] Toast 不会重复显示
- [ ] 对话框正常显示
- [ ] 不会卡顿或崩溃
```

---

### 测试 4: 响应式设计 ⭐

#### 4.1 桌面端（> 768px）

```bash
验证:
- [ ] Toast 在右上角显示
- [ ] 升级卡片横向布局（图标 | 文字 | 按钮）
- [ ] 对话框居中显示
- [ ] 所有文字清晰可读
```

#### 4.2 移动端（< 768px）

```bash
验证:
- [ ] Toast 适配小屏幕
- [ ] 升级卡片竖向布局
- [ ] 对话框全屏显示
- [ ] 按钮易于点击
```

---

## 🔍 问题排查

### 问题 1: Toast 不显示

**可能原因**:
- Toaster 组件未添加到 layout.tsx
- sonner 包未安装

**解决方法**:
```bash
# 检查 app/layout.tsx
# 应该有这一行
import { Toaster } from "@/components/ui/sonner"

# 确保 Toaster 在 body 中
<Toaster />
```

---

### 问题 2: Toast 立即显示（没有延迟）

**可能原因**:
- setTimeout 未生效

**解决方法**:
```typescript
// 确保有 setTimeout 包裹
setTimeout(() => {
  toast("Message...")
}, 2000)  // 2 秒延迟
```

---

### 问题 3: 两个对话框同时显示

**可能原因**:
- useEffect 逻辑有问题

**检查**:
```typescript
// 确保逻辑互斥
if (!isAuthenticated && isLimitReached) {
  setShowLoginPrompt(true)
  setShowUpgradePrompt(false)  // ← 关闭另一个
}
```

---

### 问题 4: 升级卡片不显示

**可能原因**:
- 条件判断错误
- Card 组件未导入

**检查**:
```typescript
// 确保条件正确
{isAuthenticated && remainingCount <= 2 && remainingCount > 0 && (
  <Card>...</Card>
)}

// 确保导入
import { Card, CardContent } from "@/components/ui/card"
```

---

## 📊 测试数据记录表

### 未登录用户测试

| 测试项 | 预期结果 | 实际结果 | 状态 |
|--------|---------|---------|------|
| 第 1-2 次无提示 | ✅ | | □ |
| 第 3-4 次 Alert | ✅ | | □ |
| 第 5 次登录对话框 | ✅ | | □ |
| 对话框内容正确 | ✅ | | □ |
| 登录按钮可用 | ✅ | | □ |

### 已登录用户测试

| 测试项 | 预期结果 | 实际结果 | 状态 |
|--------|---------|---------|------|
| 第 3 次 Toast 显示 | ✅ | | □ |
| 第 3 次升级卡片显示 | ✅ | | □ |
| 第 4 次 Toast 显示 | ✅ | | □ |
| 第 5 次升级对话框 | ✅ | | □ |
| 所有按钮跳转正确 | ✅ | | □ |

---

## 🎯 验收标准

### 基础功能（必须通过）

- [ ] 所有 5 个提示触发点正常工作
- [ ] 登录/升级对话框互斥（不同时显示）
- [ ] Toast 按钮跳转到 /pricing
- [ ] 对话框按钮跳转到 /pricing
- [ ] 升级卡片按钮跳转到 /pricing

### 用户体验（必须通过）

- [ ] Toast 不打断用户体验（有延迟）
- [ ] 对话框可以关闭
- [ ] 文案清晰易懂
- [ ] 响应式设计正常
- [ ] 动画流畅

### 数据逻辑（必须通过）

- [ ] 使用次数正确计算
- [ ] 跨天自动重置
- [ ] 登录后状态切换
- [ ] 剩余次数动态更新

---

## 🎉 测试通过后

### 监控指标

上线后监控这些数据：

1. **Toast 显示率**: 有多少用户看到了 Toast
2. **Toast 点击率**: Toast 中"View Plans"的点击率
3. **对话框转化率**: 对话框中的升级点击率
4. **升级卡片转化率**: 卡片中的升级点击率
5. **整体转化率**: 从访客到付费用户的比例

### 优化方向

根据数据调整：
- 如果 Toast 点击率低 → 优化文案
- 如果对话框转化低 → 调整特性列表
- 如果卡片被忽略 → 增强视觉效果

---

**开始测试吧！** 🧪

**测试时间**: 约 15-20 分钟  
**验收标准**: 所有复选框打勾 ✅

