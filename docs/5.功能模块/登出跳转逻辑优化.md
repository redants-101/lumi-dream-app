# ç™»å‡ºè·³è½¬é€»è¾‘ä¼˜åŒ–

## åŠŸèƒ½æ¦‚è¿°

æ ¹æ®ç”¨æˆ·æ‰€åœ¨é¡µé¢çš„ä¸åŒï¼Œç™»å‡ºåä¼šæ‰§è¡Œä¸åŒçš„è·³è½¬è¡Œä¸ºï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚

## è·³è½¬è§„åˆ™

| å½“å‰é¡µé¢ | ç™»å‡ºåè¡Œä¸º | åŸå› è¯´æ˜ |
|---------|-----------|---------|
| Dashboard | è·³è½¬åˆ° Pricing é¡µ | Dashboard æ˜¯éœ€è¦ç™»å½•çš„é¡µé¢ï¼Œç™»å‡ºåå¼•å¯¼ç”¨æˆ·äº†è§£ä»˜è´¹è®¡åˆ’ |
| Home é¡µ (/) | åˆ·æ–°å½“å‰é¡µé¢ | ä¿æŒåœ¨é¦–é¡µï¼Œæ˜¾ç¤ºæœªç™»å½•çŠ¶æ€ |
| Pricing é¡µ | åˆ·æ–°å½“å‰é¡µé¢ | ç”¨æˆ·å¯èƒ½æƒ³ä»¥æ¸¸å®¢èº«ä»½æµè§ˆå®šä»·ä¿¡æ¯ |
| å…¶ä»–é¡µé¢ | åˆ·æ–°å½“å‰é¡µé¢ | é»˜è®¤è¡Œä¸ºï¼Œä¿æŒåœ¨å½“å‰é¡µé¢ |

## ç”¨æˆ·ä½“éªŒæµç¨‹

### åœºæ™¯ 1ï¼šDashboard é¡µé¢ç™»å‡º

1. ç”¨æˆ·åœ¨ Dashboard æŸ¥çœ‹è®¢é˜…ä¿¡æ¯
2. ç‚¹å‡»ç”¨æˆ·å¤´åƒ â†’ é€‰æ‹© "Sign out"
3. âœ… ç™»å‡ºæˆåŠŸ
4. âœ… è‡ªåŠ¨è·³è½¬åˆ° Pricing é¡µé¢
5. ğŸ’¡ ç”¨æˆ·å¯ä»¥äº†è§£å„ä¸ªå¥—é¤çš„åŠŸèƒ½

**ç”¨æˆ·ä»·å€¼**ï¼šå¼•å¯¼ç”¨æˆ·é‡æ–°è€ƒè™‘è®¢é˜…æ–¹æ¡ˆï¼Œæå‡è½¬åŒ–ç‡

### åœºæ™¯ 2ï¼šHome é¡µé¢ç™»å‡º

1. ç”¨æˆ·åœ¨é¦–é¡µæµè§ˆ
2. ç‚¹å‡»ç”¨æˆ·å¤´åƒ â†’ é€‰æ‹© "Sign out"
3. âœ… ç™»å‡ºæˆåŠŸ
4. âœ… é¡µé¢åˆ·æ–°ï¼Œæ˜¾ç¤ºæœªç™»å½•çŠ¶æ€
5. ğŸ’¡ ç”¨æˆ·å¯ä»¥ç»§ç»­ä½¿ç”¨å…è´¹åŠŸèƒ½

**ç”¨æˆ·ä»·å€¼**ï¼šä¿æŒåœ¨é¦–é¡µï¼Œæ— ç¼åˆ‡æ¢åˆ°è®¿å®¢æ¨¡å¼

### åœºæ™¯ 3ï¼šPricing é¡µé¢ç™»å‡º

1. ç”¨æˆ·åœ¨ Pricing é¡µé¢æŸ¥çœ‹å¥—é¤
2. ç‚¹å‡»ç”¨æˆ·å¤´åƒ â†’ é€‰æ‹© "Sign out"
3. âœ… ç™»å‡ºæˆåŠŸ
4. âœ… é¡µé¢åˆ·æ–°ï¼Œæ˜¾ç¤ºæœªç™»å½•ä»·æ ¼
5. ğŸ’¡ ç”¨æˆ·å¯ä»¥ç»§ç»­æµè§ˆå®šä»·ä¿¡æ¯

**ç”¨æˆ·ä»·å€¼**ï¼šä¸æ‰“æ–­ç”¨æˆ·çš„æµè§ˆæµç¨‹

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒä»£ç 

**æ–‡ä»¶**: `components/user-button.tsx`

```typescript
// å¤„ç†ç™»å‡ºé€»è¾‘ï¼ˆæ ¹æ®å½“å‰é¡µé¢å†³å®šç™»å‡ºåçš„è¡Œä¸ºï¼‰
const handleSignOut = async () => {
  await signOut()
  
  // æ ¹æ®å½“å‰é¡µé¢è·¯å¾„å†³å®šç™»å‡ºåçš„è·³è½¬
  if (pathname.startsWith("/dashboard")) {
    // Dashboard é¡µé¢ â†’ è·³è½¬åˆ° Pricing é¡µ
    router.push("/pricing")
  } else if (pathname === "/" || pathname.startsWith("/pricing")) {
    // Home é¡µæˆ– Pricing é¡µ â†’ åˆ·æ–°å½“å‰é¡µé¢
    router.refresh()
  } else {
    // å…¶ä»–é¡µé¢ â†’ é»˜è®¤åˆ·æ–°
    router.refresh()
  }
}
```

### å®ç°æ­¥éª¤

1. **å¯¼å…¥å¿…è¦çš„ Hooks**
```typescript
import { usePathname, useRouter } from "next/navigation"
```

2. **è·å–è·¯å¾„å’Œè·¯ç”±å®ä¾‹**
```typescript
const pathname = usePathname()
const router = useRouter()
```

3. **åˆ›å»ºç™»å‡ºå¤„ç†å‡½æ•°**
   - è°ƒç”¨åŸæœ‰çš„ `signOut()` å‡½æ•°
   - æ ¹æ® `pathname` åˆ¤æ–­å½“å‰é¡µé¢
   - ä½¿ç”¨ `router.push()` æˆ– `router.refresh()` æ‰§è¡Œè·³è½¬

4. **æ›´æ–°æŒ‰é’®ç‚¹å‡»äº‹ä»¶**
```typescript
<DropdownMenuItem onClick={handleSignOut} className="cursor-pointer">
  <LogOut className="mr-2 h-4 w-4" />
  <span>Sign out</span>
</DropdownMenuItem>
```

## æ¶‰åŠæ–‡ä»¶

- âœ… `components/user-button.tsx` - ç”¨æˆ·æŒ‰é’®ç»„ä»¶ï¼ˆä¸»è¦ä¿®æ”¹ï¼‰

## æ‰©å±•æ€§

### æ·»åŠ æ›´å¤šé¡µé¢çš„è‡ªå®šä¹‰ç™»å‡ºè¡Œä¸º

åªéœ€åœ¨ `handleSignOut` å‡½æ•°ä¸­æ·»åŠ æ›´å¤šæ¡ä»¶åˆ¤æ–­ï¼š

```typescript
const handleSignOut = async () => {
  await signOut()
  
  if (pathname.startsWith("/dashboard")) {
    router.push("/pricing")
  } else if (pathname.startsWith("/settings")) {
    // è®¾ç½®é¡µç™»å‡º â†’ è·³è½¬åˆ°é¦–é¡µ
    router.push("/")
  } else if (pathname.startsWith("/billing")) {
    // è´¦å•é¡µç™»å‡º â†’ è·³è½¬åˆ°å®šä»·é¡µ
    router.push("/pricing")
  } else if (pathname === "/" || pathname.startsWith("/pricing")) {
    router.refresh()
  } else {
    router.refresh()
  }
}
```

### æ·»åŠ ç™»å‡ºæˆåŠŸæç¤º

å¯ä»¥åœ¨ç™»å‡ºåæ˜¾ç¤º Toast æç¤ºï¼š

```typescript
import { toast } from "sonner"

const handleSignOut = async () => {
  await signOut()
  
  toast.success("Successfully signed out")
  
  // è·³è½¬é€»è¾‘...
}
```

### æ·»åŠ ç™»å‡ºå‰ç¡®è®¤

å¯ä»¥æ·»åŠ ç¡®è®¤å¯¹è¯æ¡†ï¼Œé˜²æ­¢è¯¯æ“ä½œï¼š

```typescript
const [showLogoutConfirm, setShowLogoutConfirm] = useState(false)

// åœ¨èœå•é¡¹ä¸­æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†
<AlertDialog open={showLogoutConfirm} onOpenChange={setShowLogoutConfirm}>
  <AlertDialogTrigger asChild>
    <DropdownMenuItem onSelect={(e) => e.preventDefault()}>
      <LogOut className="mr-2 h-4 w-4" />
      <span>Sign out</span>
    </DropdownMenuItem>
  </AlertDialogTrigger>
  <AlertDialogContent>
    <AlertDialogTitle>Are you sure you want to sign out?</AlertDialogTitle>
    <AlertDialogDescription>
      You can sign in again anytime to access your account.
    </AlertDialogDescription>
    <AlertDialogFooter>
      <AlertDialogCancel>Cancel</AlertDialogCancel>
      <AlertDialogAction onClick={handleSignOut}>Sign Out</AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

## æµ‹è¯•æŒ‡å—

### æµ‹è¯•ç”¨ä¾‹

#### 1. Dashboard é¡µé¢ç™»å‡ºæµ‹è¯•

**å‰ç½®æ¡ä»¶**ï¼šå·²ç™»å½•çŠ¶æ€

1. è®¿é—® `/dashboard` é¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
3. ç‚¹å‡» "Sign out"
4. âœ… åº”è¯¥æˆåŠŸç™»å‡º
5. âœ… åº”è¯¥è‡ªåŠ¨è·³è½¬åˆ° `/pricing` é¡µé¢
6. âœ… é¡µé¢åº”è¯¥æ˜¾ç¤ºæœªç™»å½•çŠ¶æ€

#### 2. Home é¡µé¢ç™»å‡ºæµ‹è¯•

**å‰ç½®æ¡ä»¶**ï¼šå·²ç™»å½•çŠ¶æ€

1. è®¿é—® `/` é¦–é¡µ
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
3. ç‚¹å‡» "Sign out"
4. âœ… åº”è¯¥æˆåŠŸç™»å‡º
5. âœ… é¡µé¢åº”è¯¥åˆ·æ–°
6. âœ… åº”è¯¥åœç•™åœ¨é¦–é¡µ
7. âœ… å¯¼èˆªæ åº”è¯¥æ˜¾ç¤º "Sign In" æŒ‰é’®

#### 3. Pricing é¡µé¢ç™»å‡ºæµ‹è¯•

**å‰ç½®æ¡ä»¶**ï¼šå·²ç™»å½•çŠ¶æ€

1. è®¿é—® `/pricing` é¡µé¢
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
3. ç‚¹å‡» "Sign out"
4. âœ… åº”è¯¥æˆåŠŸç™»å‡º
5. âœ… é¡µé¢åº”è¯¥åˆ·æ–°
6. âœ… åº”è¯¥åœç•™åœ¨ Pricing é¡µé¢
7. âœ… ä»·æ ¼å¡ç‰‡åº”è¯¥æ˜¾ç¤ºæœªç™»å½•çŠ¶æ€çš„ CTA

#### 4. å…¶ä»–é¡µé¢ç™»å‡ºæµ‹è¯•

**å‰ç½®æ¡ä»¶**ï¼šå·²ç™»å½•çŠ¶æ€

1. è®¿é—®ä»»æ„å…¶ä»–é¡µé¢ï¼ˆå¦‚éšç§æ”¿ç­–é¡µï¼‰
2. ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ
3. ç‚¹å‡» "Sign out"
4. âœ… åº”è¯¥æˆåŠŸç™»å‡º
5. âœ… é¡µé¢åº”è¯¥åˆ·æ–°
6. âœ… åº”è¯¥åœç•™åœ¨å½“å‰é¡µé¢

### è¾¹ç•Œæƒ…å†µ

- âœ… Dashboard å­è·¯å¾„ï¼ˆå¦‚ `/dashboard/settings`ï¼‰ä¹Ÿåº”è¯¥è·³è½¬åˆ° Pricing
- âœ… Pricing å­è·¯å¾„ï¼ˆå¦‚ `/pricing/success`ï¼‰åº”è¯¥åˆ·æ–°å½“å‰é¡µé¢
- âœ… ç™»å‡ºè¿‡ç¨‹ä¸­ç”¨æˆ·ä¸åº”è¯¥èƒ½å†æ¬¡ç‚¹å‡»ç™»å‡ºæŒ‰é’®
- âœ… ç™»å‡ºå¤±è´¥æ—¶åº”è¯¥æœ‰é€‚å½“çš„é”™è¯¯æç¤º

### è‡ªåŠ¨åŒ–æµ‹è¯•å»ºè®®

```typescript
// E2E æµ‹è¯•ç¤ºä¾‹ï¼ˆPlaywrightï¼‰
test("logout from dashboard redirects to pricing", async ({ page }) => {
  // ç™»å½•
  await login(page)
  
  // è®¿é—® Dashboard
  await page.goto("/dashboard")
  
  // ç‚¹å‡»ç”¨æˆ·å¤´åƒ
  await page.click("[data-testid=user-button]")
  
  // ç‚¹å‡»ç™»å‡º
  await page.click("[data-testid=sign-out]")
  
  // éªŒè¯è·³è½¬åˆ° Pricing é¡µé¢
  await expect(page).toHaveURL("/pricing")
  
  // éªŒè¯æœªç™»å½•çŠ¶æ€
  await expect(page.locator("[data-testid=sign-in-button]")).toBeVisible()
})
```

## ä¸šåŠ¡ä»·å€¼

### 1. æå‡è½¬åŒ–ç‡

- Dashboard ç™»å‡ºåå¼•å¯¼åˆ° Pricing é¡µé¢
- ç”¨æˆ·å¯èƒ½é‡æ–°è€ƒè™‘è®¢é˜…æ–¹æ¡ˆ
- é™ä½ç”¨æˆ·æµå¤±ç‡

### 2. æ”¹å–„ç”¨æˆ·ä½“éªŒ

- ä¸åŒé¡µé¢çš„ç™»å‡ºè¡Œä¸ºç¬¦åˆç”¨æˆ·å¿ƒç†é¢„æœŸ
- å‡å°‘ç”¨æˆ·è¿·å¤±æ„Ÿ
- æä¾›æ›´æµç•…çš„å¯¼èˆªä½“éªŒ

### 3. æ•°æ®æ´å¯Ÿ

å¯ä»¥é€šè¿‡åˆ†æç™»å‡ºè¡Œä¸ºæ¥ä¼˜åŒ–äº§å“ï¼š

```typescript
// åœ¨ç™»å‡ºæ—¶è®°å½•åˆ†æäº‹ä»¶
const handleSignOut = async () => {
  // è®°å½•ç™»å‡ºäº‹ä»¶
  analytics.track("user_logout", {
    from_page: pathname,
    redirect_to: pathname.startsWith("/dashboard") ? "/pricing" : "current"
  })
  
  await signOut()
  // è·³è½¬é€»è¾‘...
}
```

## æ€§èƒ½è€ƒè™‘

- âœ… `router.refresh()` åªåˆ·æ–°æœåŠ¡ç«¯ç»„ä»¶ï¼Œæ¯”æ•´é¡µåˆ·æ–°æ›´å¿«
- âœ… `router.push()` ä½¿ç”¨å®¢æˆ·ç«¯è·¯ç”±ï¼Œæ— éœ€é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢
- âœ… ç™»å‡º API è°ƒç”¨æ˜¯å¼‚æ­¥çš„ï¼Œä¸ä¼šé˜»å¡ UI
- âœ… ä½¿ç”¨äº† Next.js çš„è·¯ç”±ç¼“å­˜æœºåˆ¶

## æœªæ¥ä¼˜åŒ–æ–¹å‘

1. **ä¸ªæ€§åŒ–è·³è½¬**
   - è®°ä½ç”¨æˆ·æœ€å¸¸è®¿é—®çš„é¡µé¢
   - ç™»å‡ºåè·³è½¬åˆ°ç”¨æˆ·æœ€æ„Ÿå…´è¶£çš„é¡µé¢

2. **æ™ºèƒ½å¼•å¯¼**
   - å¦‚æœç”¨æˆ·æ˜¯ä»˜è´¹ç”¨æˆ·ç™»å‡ºï¼Œæ˜¾ç¤ºæŒ½ç•™å¼¹çª—
   - å¦‚æœç”¨æˆ·æ˜¯å…è´¹ç”¨æˆ·ï¼Œå¼•å¯¼å‡çº§

3. **ç™»å‡ºåŸå› æ”¶é›†**
   - æ·»åŠ "ä¸ºä»€ä¹ˆè¦ç™»å‡º"çš„å¯é€‰åé¦ˆ
   - æ”¶é›†ç”¨æˆ·æµå¤±åŸå› 

4. **å¿«é€Ÿé‡æ–°ç™»å½•**
   - è®°ä½ç”¨æˆ·åå¥½çš„ç™»å½•æ–¹å¼
   - ä¸€é”®é‡æ–°ç™»å½•åŠŸèƒ½

---

**å®æ–½å®Œæˆæ—¶é—´**: 2025-10-28  
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•  
**ç›¸å…³åŠŸèƒ½**: Dashboardç™»å½•å¼•å¯¼åŠŸèƒ½

