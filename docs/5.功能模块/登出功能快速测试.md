# 登出功能快速测试指南

## 快速测试步骤

### ✅ 测试 1: Dashboard 登出 → 跳转 Pricing

1. 登录账号
2. 访问 http://localhost:3000/dashboard
3. 点击右上角用户头像
4. 点击 "Sign out"
5. **期望结果**: 
   - ✅ 登出成功
   - ✅ 自动跳转到 `/pricing` 页面
   - ✅ 显示未登录状态

### ✅ 测试 2: Home 页登出 → 刷新当前页

1. 登录账号
2. 访问 http://localhost:3000/
3. 点击右上角用户头像
4. 点击 "Sign out"
5. **期望结果**: 
   - ✅ 登出成功
   - ✅ 停留在首页
   - ✅ 页面刷新，显示 "Sign In" 按钮

### ✅ 测试 3: Pricing 页登出 → 刷新当前页

1. 登录账号
2. 访问 http://localhost:3000/pricing
3. 点击右上角用户头像
4. 点击 "Sign out"
5. **期望结果**: 
   - ✅ 登出成功
   - ✅ 停留在 Pricing 页面
   - ✅ 页面刷新

### ✅ 测试 4: 其他页面登出 → 刷新当前页

1. 登录账号
2. 访问 http://localhost:3000/privacy
3. 点击右上角用户头像
4. 点击 "Sign out"
5. **期望结果**: 
   - ✅ 登出成功
   - ✅ 停留在隐私政策页面
   - ✅ 页面刷新

## 测试矩阵

| 测试场景 | 当前页面 | 操作 | 期望结果 |
|---------|---------|-----|---------|
| 测试 1 | `/dashboard` | 点击登出 | 跳转到 `/pricing` |
| 测试 2 | `/` | 点击登出 | 刷新，停留在 `/` |
| 测试 3 | `/pricing` | 点击登出 | 刷新，停留在 `/pricing` |
| 测试 4 | `/privacy` | 点击登出 | 刷新，停留在 `/privacy` |
| 测试 5 | `/dashboard/anything` | 点击登出 | 跳转到 `/pricing` |
| 测试 6 | `/pricing/success` | 点击登出 | 刷新，停留在当前页 |

## 常见问题排查

### 问题 1: Dashboard 登出后跳转到首页而不是 Pricing

**可能原因**: Dashboard 页面的路由保护逻辑可能与登出逻辑冲突

**解决方案**: 
- 检查 `app/dashboard/page.tsx` 的 useEffect
- 确保 UserButton 的 router.push 优先执行

### 问题 2: 页面刷新后还显示登录状态

**可能原因**: 认证状态缓存未清除

**解决方案**:
- 检查 `hooks/use-auth.ts` 的 signOut 函数
- 确保 sessionStorage 中的缓存被清除

### 问题 3: 登出后控制台报错

**可能原因**: 某些组件尝试访问已登出的用户数据

**解决方案**:
- 检查控制台错误信息
- 确保所有组件都正确处理 `user === null` 的情况

## 开发者工具检查

### 1. 网络请求检查

打开浏览器开发者工具 → Network 标签

登出时应该看到：
```
POST /api/auth/logout
Status: 200
Response: { "success": true }
```

### 2. React 组件状态检查

使用 React DevTools 检查：
- `useAuth` hook 的 `user` 状态应该从有值变为 `null`
- `useAuth` hook 的 `isAuthenticated` 应该从 `true` 变为 `false`

### 3. 路由变化检查

在控制台观察：
```javascript
// Dashboard 登出
console.log(window.location.pathname) 
// 应该从 "/dashboard" 变为 "/pricing"

// Home 登出
console.log(window.location.pathname)
// 应该保持 "/"
```

## 自动化测试命令

如果项目配置了 E2E 测试，可以运行：

```bash
# 运行登出功能测试
npm run test:e2e -- logout

# 或者
pnpm test:e2e -- logout
```

## 测试通过标准

所有以下条件都满足才算测试通过：

- ✅ Dashboard 登出后跳转到 Pricing
- ✅ Home 和 Pricing 登出后刷新当前页
- ✅ 登出后导航栏显示 "Sign In" 按钮
- ✅ 登出后无法访问 Dashboard（自动跳转）
- ✅ 登出后可以重新登录
- ✅ 无控制台错误或警告
- ✅ 移动端和桌面端行为一致

## 报告问题

如果发现问题，请记录以下信息：

1. **浏览器**: Chrome/Firefox/Safari 版本
2. **当前页面**: 测试时所在的页面路径
3. **期望行为**: 应该发生什么
4. **实际行为**: 实际发生了什么
5. **控制台错误**: 是否有错误信息
6. **重现步骤**: 如何重现问题

---

**开始测试**: http://localhost:3000  
**需要账号**: 使用 Google 或 GitHub 登录

