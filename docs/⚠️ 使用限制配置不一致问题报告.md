# ⚠️ 使用限制配置不一致问题报告

**检查日期**: 2025-10-28  
**检查范围**: 全项目配置、文档、代码

---

## 📊 当前标准配置 (lib/usage-limits.ts)

```typescript
export const USAGE_LIMITS = {
  anonymous: {
    daily: 2,     // 每天 2 次
    monthly: 4,   // 每月 4 次 ✅ 标准
  },
  free: {
    daily: 5,     // 每天 5 次
    monthly: 10,  // 每月 10 次 ✅ 标准
  },
  basic: {
    daily: 10,    // 每天 10 次
    monthly: 50,  // 每月 50 次 ✅ 标准
  },
  pro: {
    daily: 20,    // 每天 20 次
    monthly: 200, // 每月 200 次 ✅ 标准
  },
}
```

---

## ❌ 发现的不一致问题

### 问题 1: lib/pricing-config.ts - 对比表格错误

**位置**: `lib/pricing-config.ts` 行 332

**当前内容**:
```typescript
{
  category: "使用限制",
  items: [
    { name: "每月解梦次数", free: "5 次", basic: "50 次", pro: "200 次" },
    //                            ❌ 错误！应该是 "10 次"
  ]
}
```

**应该修改为**:
```typescript
{
  category: "使用限制",
  items: [
    { name: "每月解梦次数", free: "10 次", basic: "50 次", pro: "200 次" },
    //                            ✅ 正确
  ]
}
```

**影响**: 
- 用户在定价对比页面看到错误的限制信息
- 可能导致用户误解

---

### 问题 2: lib/pricing-config.ts - FAQ 答案错误

**位置**: `lib/pricing-config.ts` 行 319

**当前内容**:
```typescript
{
  question: "Does the free tier expire?",
  answer: "No. The free tier is available forever, with 5 interpretations automatically reset each month."
  //                                                     ❌ 错误！应该是 10
}
```

**应该修改为**:
```typescript
{
  question: "Does the free tier expire?",
  answer: "No. The free tier is available forever, with 10 interpretations automatically reset each month."
  //                                                     ✅ 正确
}
```

**影响**:
- FAQ 中的信息不准确
- 误导用户对免费额度的理解

---

### 问题 3: lib/pricing-config.ts - 成本分析注释错误

**位置**: `lib/pricing-config.ts` 行 51

**当前内容**:
```typescript
costs: {
  ai: 0.01075,             // AI 模型成本 (5 次 × $0.00215)
  //                         ❌ 应该是 10 次
  infrastructure: 0.02,
  total: 0.03075,
}
```

**应该修改为**:
```typescript
costs: {
  ai: 0.0215,              // AI 模型成本 (10 次 × $0.00215)
  //                         ✅ 正确
  infrastructure: 0.02,
  total: 0.0415,           // ✅ 更新总成本
}
```

**影响**:
- 成本分析不准确
- 可能影响商业决策

---

## ✅ 已确认正确的配置

### 1. lib/pricing-config.ts - 配置对象 ✅

```typescript
PRICING.FREE.limits = {
  monthlyInterpretations: 10,  // ✅ 正确
  maxDreamLength: 500,
  // ...
}
```

### 2. lib/pricing-config.ts - 功能列表 ✅

```typescript
features: [
  "10 dream interpretations/month",  // ✅ 正确
  "Up to 500 characters per dream",
  // ...
]
```

### 3. app/page.tsx - 每日限制提示 ✅

```typescript
// 这些是每日（daily）限制的提示，所以 5 次是正确的
"You've used all 5 free interpretations today"  // ✅ daily 限制
"Sign in to unlock 5 more interpretations today"  // ✅ daily 限制
```

---

## 📋 完整对比表

| 配置项 | 标准值 (usage-limits.ts) | pricing-config.ts | 状态 |
|--------|------------------------|-------------------|------|
| **Anonymous - 每日** | 2 | - | ✅ |
| **Anonymous - 每月** | 4 | - | ✅ |
| **Free - 每日** | 5 | - | ✅ |
| **Free - 每月** | **10** | 10 (配置) ✅ | ✅ |
| **Free - 每月** | **10** | ❌ 5 (对比表) | ❌ 需修复 |
| **Free - 每月** | **10** | ❌ 5 (FAQ) | ❌ 需修复 |
| **Free - 成本** | 10 次 | ❌ 5 次 (注释) | ❌ 需修复 |
| **Basic - 每日** | 10 | - | ✅ |
| **Basic - 每月** | 50 | 50 ✅ | ✅ |
| **Pro - 每日** | 20 | - | ✅ |
| **Pro - 每月** | 200 | 200 ✅ | ✅ |

---

## 🔧 修复清单

### 高优先级（用户可见）

- [ ] **修复 1**: 对比表格 - 将 "5 次" 改为 "10 次"
- [ ] **修复 2**: FAQ 答案 - 将 "5 interpretations" 改为 "10 interpretations"

### 中优先级（内部文档）

- [ ] **修复 3**: 成本分析 - 更新注释和计算值
  - AI 成本: 0.01075 → 0.0215
  - 总成本: 0.03075 → 0.0415

### 低优先级（历史文档）

- [ ] 更新 `docs/` 中旧的文档（如果需要）
- [ ] 确保所有文档引用最新的限制值

---

## 💡 为什么会出现不一致

### 历史变更:

1. **最初设计**: Free 用户每月 5 次
2. **后来调整**: Free 用户每月增加到 10 次
3. **遗留问题**: 
   - 代码配置更新了（`monthlyInterpretations: 10`）
   - 但对比表格和 FAQ 没有同步更新

### 双重限制系统的混淆:

- **每日限制**: Free 用户 5 次/天 ✅
- **每月限制**: Free 用户 10 次/月 ✅
- 有些地方混淆了"每日"和"每月"

---

## 🎯 修复后的效果

### 修复前:

```
用户看到对比表格: "Free 用户每月 5 次"
用户阅读 FAQ: "每月自动重置 5 次"
用户实际使用: 每月可以用 10 次
  ↓
❌ 用户困惑："为什么我能用 10 次？"
```

### 修复后:

```
用户看到对比表格: "Free 用户每月 10 次"
用户阅读 FAQ: "每月自动重置 10 次"
用户实际使用: 每月可以用 10 次
  ↓
✅ 信息一致，用户清楚
```

---

## 📊 修复后的完整限制表

| 用户类型 | 每日限制 | 每月限制 | 梦境长度 | AI 模型 |
|---------|---------|---------|---------|---------|
| **未登录 (anonymous)** | 2 次 | 4 次 | 500 字符 | Gemini |
| **已登录 Free** | 5 次 | **10 次** ✅ | 500 字符 | Claude Haiku |
| **Basic** | 10 次 | 50 次 | 1000 字符 | Claude Haiku |
| **Pro** | 20 次 | 200 次 | 2000 字符 | Claude Sonnet |

---

## 🔍 验证方法

### 1. 代码配置验证

```bash
# 检查 usage-limits.ts
grep -A 3 "free:" lib/usage-limits.ts
# 应显示: monthly: 10

# 检查 pricing-config.ts 配置
grep "monthlyInterpretations" lib/pricing-config.ts
# FREE 应显示: 10
```

### 2. 前端显示验证

1. 访问 `/pricing` 页面
2. 查看对比表格 → 应显示 "10 次"
3. 查看 FAQ 部分 → 应显示 "10 interpretations"

### 3. 实际使用验证

1. 注册新账号（Free 用户）
2. 使用 10 次解梦
3. 第 11 次应提示达到月度限制

---

## 📚 相关文件清单

### 需要修改的文件

| 文件 | 修改内容 | 优先级 |
|------|---------|-------|
| `lib/pricing-config.ts` | 对比表格：5 → 10 | 🔴 高 |
| `lib/pricing-config.ts` | FAQ：5 → 10 | 🔴 高 |
| `lib/pricing-config.ts` | 成本注释：5 → 10 | 🟡 中 |
| `lib/pricing-config.ts` | 成本值更新 | 🟡 中 |

### 已确认正确的文件

| 文件 | 状态 |
|------|------|
| `lib/usage-limits.ts` | ✅ 正确 |
| `lib/pricing-config.ts` (配置对象) | ✅ 正确 |
| `lib/pricing-config.ts` (features) | ✅ 正确 |
| `app/page.tsx` | ✅ 正确（每日限制） |

---

## 🚀 下一步行动

1. **立即修复**: 修复 `lib/pricing-config.ts` 中的 3 处错误
2. **测试验证**: 检查定价页面显示
3. **文档更新**: 确保所有文档引用正确的数字
4. **代码审查**: 搜索项目中所有 "5" 相关的提及，确认是否正确

---

**报告生成**: 2025-10-28  
**优先级**: 🔴 高（用户可见的信息不一致）  
**预计修复时间**: 10 分钟

