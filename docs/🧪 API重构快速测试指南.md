# ğŸ§ª API é‡æ„å¿«é€Ÿæµ‹è¯•æŒ‡å—

**æµ‹è¯•ç›®æ ‡**: éªŒè¯ API å“åº”æ ¼å¼ç»Ÿä¸€é‡æ„åæ‰€æœ‰åŠŸèƒ½æ­£å¸¸è¿è¡Œ  
**é¢„è®¡æ—¶é—´**: 10-15 åˆ†é’Ÿ

---

## ğŸš€ å¿«é€Ÿæµ‹è¯•æ­¥éª¤

### 1ï¸âƒ£ å‡†å¤‡å·¥ä½œï¼ˆ1åˆ†é’Ÿï¼‰

```bash
# 1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev

# 2. æ‰“å¼€æµè§ˆå™¨è®¿é—®
http://localhost:3000

# 3. æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆF12ï¼‰æŸ¥çœ‹ Console å’Œ Network
```

---

### 2ï¸âƒ£ æµ‹è¯•æ¸¸å®¢æ¨¡å¼ï¼ˆ2åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ `/api/interpret` API

âœ… **æµ‹è¯•æ­¥éª¤**:
1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’Œ localStorageï¼ˆå¯é€‰ï¼‰
2. åœ¨é¦–é¡µè¾“å…¥æ¢¦å¢ƒï¼š`I dreamed of flying over the ocean`
3. ç‚¹å‡» "Illuminate My Dream" æŒ‰é’®
4. ç­‰å¾… 5-10 ç§’

**âœ… é¢„æœŸç»“æœ**:
- âœ… çœ‹åˆ°åŠ è½½çŠ¶æ€ï¼š"Lumi is reflecting on your dream..."
- âœ… æ˜¾ç¤ºè§£æç»“æœå¡ç‰‡
- âœ… Console æ˜¾ç¤ºï¼š`[AIService] AI Interpretation Stats`
- âœ… å³ä¸Šè§’æ˜¾ç¤ºå‰©ä½™æ¬¡æ•°é€’å‡

**ğŸ” Network æ£€æŸ¥**:
- è¯·æ±‚ï¼š`POST /api/interpret`
- å“åº”æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {
    "interpretation": "..."
  },
  "metadata": {
    "timestamp": "...",
    "userTier": "anonymous",
    "model": "..."
  }
}
```

---

### 3ï¸âƒ£ æµ‹è¯•ç”¨æˆ·ç™»å½•ï¼ˆ2åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ `/api/auth/login` API

âœ… **æµ‹è¯•æ­¥éª¤**:
1. ç‚¹å‡»å¯¼èˆªæ çš„ "Sign In" æŒ‰é’®
2. é€‰æ‹© Google æˆ– GitHub ç™»å½•
3. å®Œæˆ OAuth ç™»å½•æµç¨‹

**âœ… é¢„æœŸç»“æœ**:
- âœ… è·³è½¬åˆ° OAuth æä¾›å•†é¡µé¢
- âœ… ç™»å½•æˆåŠŸåè¿”å›é¦–é¡µ
- âœ… å¯¼èˆªæ æ˜¾ç¤ºç”¨æˆ·å¤´åƒå’Œé‚®ç®±
- âœ… å³ä¸Šè§’æ˜¾ç¤º Free ç”¨æˆ·é™åˆ¶ï¼ˆ5 today, 10 this monthï¼‰

**ğŸ” Network æ£€æŸ¥**:
- è¯·æ±‚ï¼š`POST /api/auth/login`
- å“åº”æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {
    "url": "https://accounts.google.com/..."
  },
  "metadata": {
    "provider": "google",
    "redirectPath": "/"
  }
}
```

---

### 4ï¸âƒ£ æµ‹è¯•è®¢é˜…æŸ¥è¯¢ï¼ˆ1åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ `/api/subscription/manage` (GET) å’Œ `/api/usage` (GET)

âœ… **æµ‹è¯•æ­¥éª¤**:
1. ç™»å½•ååˆ·æ–°é¡µé¢
2. æŸ¥çœ‹ Network é¢æ¿

**âœ… é¢„æœŸç»“æœ**:
- âœ… è‡ªåŠ¨è°ƒç”¨ `/api/subscription/manage`
- âœ… è‡ªåŠ¨è°ƒç”¨ `/api/usage`
- âœ… Console æ˜¾ç¤ºï¼š`[Usage Limit V2] User subscription loaded: free`
- âœ… Console æ˜¾ç¤ºï¼š`[Usage Limit V2] âœ… Synced from database`

**ğŸ” Network æ£€æŸ¥**:

**`GET /api/subscription/manage`**:
```json
{
  "success": true,
  "data": {
    "tier": "free",
    "status": "active"
  },
  "metadata": {
    "source": "default",
    "userId": "..."
  }
}
```

**`GET /api/usage`**:
```json
{
  "success": true,
  "data": {
    "tier": "free",
    "usage": { "daily": 0, "monthly": 0 },
    "limits": { "daily": 5, "monthly": 10 },
    "remaining": { "daily": 5, "monthly": 10 }
  },
  "metadata": {
    "source": "database",
    "userId": "..."
  }
}
```

---

### 5ï¸âƒ£ æµ‹è¯•å®šä»·é¡µé¢ï¼ˆ2åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ `/api/checkout/create-session` API

âœ… **æµ‹è¯•æ­¥éª¤**:
1. è®¿é—® `/pricing` é¡µé¢
2. ç‚¹å‡» Basic æˆ– Pro å¥—é¤çš„ "Subscribe" æŒ‰é’®
3. è§‚å¯Ÿè·³è½¬ï¼ˆæ— éœ€å®Œæˆæ”¯ä»˜ï¼‰

**âœ… é¢„æœŸç»“æœ**:
- âœ… æ˜¾ç¤ºåŠ è½½çŠ¶æ€ï¼š"Processing..."
- âœ… è·³è½¬åˆ° Creem æ”¯ä»˜é¡µé¢ï¼ˆæˆ–æ˜¾ç¤ºç™»å½•å¯¹è¯æ¡†ï¼‰
- âœ… Console æ˜¾ç¤ºï¼š`[Pricing] Creating checkout session for: basic monthly`

**ğŸ” Network æ£€æŸ¥**:
- è¯·æ±‚ï¼š`POST /api/checkout/create-session`
- å“åº”æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {
    "sessionId": "session_xxx",
    "checkoutUrl": "https://checkout.creem.io/..."
  },
  "metadata": {
    "userId": "...",
    "tier": "basic",
    "billingCycle": "monthly",
    "productId": "..."
  }
}
```

---

### 6ï¸âƒ£ æµ‹è¯• Dashboardï¼ˆ1åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ Dashboard é¡µé¢æ•°æ®åŠ è½½

âœ… **æµ‹è¯•æ­¥éª¤**:
1. ç™»å½•åè®¿é—® `/dashboard`
2. æŸ¥çœ‹é¡µé¢å†…å®¹

**âœ… é¢„æœŸç»“æœ**:
- âœ… æ˜¾ç¤ºå½“å‰å¥—é¤ï¼šFree
- âœ… æ˜¾ç¤ºä½¿ç”¨ç»Ÿè®¡ï¼ˆæ¨¡æ‹Ÿæ•°æ®ï¼‰
- âœ… æ˜¾ç¤ºå¥—é¤è¯¦æƒ…
- âœ… æ˜¾ç¤ºå‡çº§æŒ‰é’®

**ğŸ” Console æ£€æŸ¥**:
- æ— é”™è¯¯ä¿¡æ¯
- æ­£ç¡®åŠ è½½è®¢é˜…æ•°æ®

---

### 7ï¸âƒ£ æµ‹è¯•ç™»å‡ºï¼ˆ1åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ `/api/auth/logout` API

âœ… **æµ‹è¯•æ­¥éª¤**:
1. ç‚¹å‡»ç”¨æˆ·å¤´åƒ
2. ç‚¹å‡» "Sign Out" æŒ‰é’®
3. è§‚å¯Ÿé¡µé¢å˜åŒ–

**âœ… é¢„æœŸç»“æœ**:
- âœ… è·³è½¬å›é¦–é¡µ
- âœ… å¯¼èˆªæ æ˜¾ç¤º "Sign In" æŒ‰é’®
- âœ… å³ä¸Šè§’æ˜¾ç¤ºæ¸¸å®¢é™åˆ¶ï¼ˆ2 today, 4 this monthï¼‰
- âœ… Console æ˜¾ç¤ºï¼š`[Auth] Cache cleared on sign out`

**ğŸ” Network æ£€æŸ¥**:
- è¯·æ±‚ï¼š`POST /api/auth/logout`
- å“åº”æ ¼å¼ï¼š
```json
{
  "success": true,
  "data": {
    "message": "Successfully logged out"
  },
  "metadata": {
    "loggedOutAt": "2025-10-29T..."
  }
}
```

---

### 8ï¸âƒ£ æµ‹è¯•é”™è¯¯å¤„ç†ï¼ˆ1åˆ†é’Ÿï¼‰

**ç›®æ ‡**: éªŒè¯ API é”™è¯¯å“åº”æ ¼å¼

âœ… **æµ‹è¯•æ­¥éª¤**:
1. æ–­å¼€ç½‘ç»œè¿æ¥
2. å°è¯•è§£ææ¢¦å¢ƒ
3. è§‚å¯Ÿé”™è¯¯æç¤º

**âœ… é¢„æœŸç»“æœ**:
- âœ… æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯æç¤ºï¼š"It seems the connection is a bit foggy..."
- âœ… é¡µé¢ä¸å´©æºƒ
- âœ… å¯ä»¥é‡è¯•

---

## ğŸ“Š æµ‹è¯•ç»“æœè®°å½•

### âœ… åŠŸèƒ½æµ‹è¯•æ¸…å•

| æµ‹è¯•é¡¹ | API è·¯ç”± | çŠ¶æ€ | å¤‡æ³¨ |
|--------|---------|------|------|
| æ¸¸å®¢è§£ææ¢¦å¢ƒ | `POST /api/interpret` | â¬œ | |
| ç”¨æˆ·ç™»å½• | `POST /api/auth/login` | â¬œ | |
| æŸ¥è¯¢è®¢é˜… | `GET /api/subscription/manage` | â¬œ | |
| æŸ¥è¯¢ä½¿ç”¨æ¬¡æ•° | `GET /api/usage` | â¬œ | |
| åˆ›å»ºæ”¯ä»˜ä¼šè¯ | `POST /api/checkout/create-session` | â¬œ | |
| Dashboard åŠ è½½ | `GET /api/subscription/manage` | â¬œ | |
| ç”¨æˆ·ç™»å‡º | `POST /api/auth/logout` | â¬œ | |
| é”™è¯¯å¤„ç† | æ‰€æœ‰ API | â¬œ | |

**æµ‹è¯•ç¬¦å·**:
- âœ… é€šè¿‡
- âŒ å¤±è´¥
- âš ï¸ éƒ¨åˆ†é€šè¿‡
- â¬œ æœªæµ‹è¯•

---

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜ 1: API è¿”å› 401 Unauthorized

**å¯èƒ½åŸå› **:
- ç”¨æˆ·æœªç™»å½•
- Session è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥æ˜¯å¦å·²ç™»å½•
2. é‡æ–°ç™»å½•
3. æ£€æŸ¥ Supabase é…ç½®

---

### é—®é¢˜ 2: å“åº”æ ¼å¼ä¸å¯¹

**æ£€æŸ¥ç‚¹**:
1. API è·¯ç”±æ˜¯å¦æ­£ç¡®å¯¼å…¥äº† `successResponse` / `errorResponse`
2. å‰ç«¯æ˜¯å¦ä½¿ç”¨ `result.data` è€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨ `data`
3. æ£€æŸ¥ TypeScript ç±»å‹æ˜¯å¦æ­£ç¡®

---

### é—®é¢˜ 3: å‰ç«¯æ˜¾ç¤ºé”™è¯¯

**æ£€æŸ¥ç‚¹**:
1. æ‰“å¼€ Console æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
2. æ£€æŸ¥ Network é¢æ¿çš„å“åº”
3. ç¡®è®¤æ•°æ®è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆ`result.data.xxx`ï¼‰

---

## ğŸ¯ å¿«é€ŸéªŒè¯å‘½ä»¤

```bash
# 1. æ£€æŸ¥æ‰€æœ‰ API è·¯ç”±æ˜¯å¦å¯¼å…¥äº†ç»Ÿä¸€å“åº”å·¥å…·
grep -r "successResponse\|errorResponse" app/api/

# 2. æ£€æŸ¥å‰ç«¯æ˜¯å¦ä½¿ç”¨ result.data
grep -r "result\.data\." hooks/ app/

# 3. æ£€æŸ¥æ˜¯å¦æœ‰ TypeScript é”™è¯¯
npm run build
```

---

## âœ… æµ‹è¯•å®Œæˆæ ‡å‡†

æ‰€æœ‰ä»¥ä¸‹æ¡ä»¶éƒ½æ»¡è¶³å³ä¸ºæµ‹è¯•é€šè¿‡ï¼š

- âœ… æ‰€æœ‰ 8 ä¸ªæµ‹è¯•é¡¹éƒ½é€šè¿‡
- âœ… Console æ— é”™è¯¯ä¿¡æ¯
- âœ… Network å“åº”æ ¼å¼ç¬¦åˆé¢„æœŸ
- âœ… ç”¨æˆ·ä½“éªŒæµç•…ï¼Œæ— å¡é¡¿
- âœ… é”™è¯¯å¤„ç†å‹å¥½

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
## æµ‹è¯•æŠ¥å‘Š

**æµ‹è¯•æ—¶é—´**: 2025-10-29 XX:XX
**æµ‹è¯•ç¯å¢ƒ**: localhost:3000
**æµ‹è¯•äººå‘˜**: [ä½ çš„åå­—]

### æµ‹è¯•ç»“æœ
- æ¸¸å®¢è§£ææ¢¦å¢ƒ: âœ… é€šè¿‡
- ç”¨æˆ·ç™»å½•: âœ… é€šè¿‡
- æŸ¥è¯¢è®¢é˜…: âœ… é€šè¿‡
- æŸ¥è¯¢ä½¿ç”¨æ¬¡æ•°: âœ… é€šè¿‡
- åˆ›å»ºæ”¯ä»˜ä¼šè¯: âœ… é€šè¿‡
- Dashboard åŠ è½½: âœ… é€šè¿‡
- ç”¨æˆ·ç™»å‡º: âœ… é€šè¿‡
- é”™è¯¯å¤„ç†: âœ… é€šè¿‡

### å‘ç°çš„é—®é¢˜
[å¦‚æœæœ‰é—®é¢˜ï¼Œåœ¨è¿™é‡Œè®°å½•]

### æ€»ä½“è¯„ä»·
âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥éƒ¨ç½²
```

---

## ğŸš€ æµ‹è¯•é€šè¿‡åçš„ä¸‹ä¸€æ­¥

1. âœ… **æäº¤ä»£ç **
   ```bash
   git add .
   git commit -m "âœ¨ Unify API response format across all endpoints"
   ```

2. âœ… **éƒ¨ç½²åˆ°æµ‹è¯•ç¯å¢ƒ**
   ```bash
   vercel deploy
   ```

3. âœ… **åœ¨æµ‹è¯•ç¯å¢ƒå†æ¬¡éªŒè¯**

4. âœ… **éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ**
   ```bash
   vercel deploy --prod
   ```

5. âœ… **ç›‘æ§æ—¥å¿—å’Œé”™è¯¯**

---

ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰

